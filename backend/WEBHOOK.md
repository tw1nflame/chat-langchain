# Настройка Webhook

## Конфигурация

Webhook URL настраивается через переменные окружения в файле `.env`.

### Настройка .env файла

1. Скопируйте файл `.env.example` в `.env`:
   ```bash
   cp .env.example .env
   ```

2. Отредактируйте `.env` файл и укажите ваш webhook URL:
   ```env
   WEBHOOK_URL=http://localhost:5678/webhook/your-webhook-id-here
   ```

### Формат webhook'а

Приложение отправляет POST запрос на указанный URL со следующей структурой:

```json
{
  "chatInput": "Текст сообщения пользователя",
  "sessionId": "uuid-сессии",
  "files": [
    {
      "name": "filename.txt",
      "type": "text/plain",
      "size": 1024,
      "content": "base64-содержимое-файла"
    }
  ]
}
```

### Ожидаемый ответ

Webhook должен возвращать JSON в одном из форматов:

#### Формат 1 - Объект:
```json
{
  "output": "Ответ ассистента",
  "files": ["base64-файл-1", "base64-файл-2"]
}
```

#### Формат 2 - Массив:
```json
[
  {
    "output": "Ответ ассистента", 
    "files": ["base64-файл-1", "base64-файл-2"]
  }
]
```

### Альтернативные поля ответа

Приложение пытается извлечь текст ответа из следующих полей (в порядке приоритета):
- `output`
- `text_response` 
- `message`
- `response`

### Настройки таймаута

- Таймаут запроса: 120 секунд
- При ошибке возвращается дефолтный ответ

### Логирование

Все взаимодействия с webhook логируются в файл `logs/webhook.log`.
